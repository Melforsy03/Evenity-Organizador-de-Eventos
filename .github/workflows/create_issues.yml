name: Resetear Issues del Proyecto

on:
  workflow_dispatch:  # Ejecutar manualmente desde GitHub Actions

jobs:
  resetear_issues:
    runs-on: ubuntu-latest
    steps:
      - name: Borrar todos los issues abiertos
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          echo "üîç Buscando issues abiertos..."
          issues=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
                      -H "Accept: application/vnd.github+json" \
                      https://api.github.com/repos/$REPO/issues?state=open | jq '.[].number')

          for issue in $issues; do
            echo "‚ùå Cerrando issue #$issue..."
            curl -s -X PATCH -H "Authorization: token $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              https://api.github.com/repos/$REPO/issues/$issue \
              -d '{"state": "closed"}'
          done

      - name: Crear Issues iniciales (Semana 1-8)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
          crear_issue() {
            titulo=$1
            cuerpo=$2
            echo "‚ûï Creando issue: $titulo"
            curl -s -X POST -H "Authorization: token $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              https://api.github.com/repos/$REPO/issues \
              -d "{\"title\":\"$titulo\",\"body\":\"$cuerpo\"}" > /dev/null
          }

          crear_issue "Semana 1: Definici√≥n del alcance y arquitectura" "Definir el alcance del proyecto, arquitectura y distribuci√≥n de tareas."
          crear_issue "Semana 2: Implementaci√≥n del crawler y extracci√≥n de datos" "Desarrollar el m√≥dulo crawler.py para extracci√≥n de eventos y validaci√≥n."
          crear_issue "Semana 3: Normalizaci√≥n y procesamiento de eventos" "Construcci√≥n del m√≥dulo procesamiento.py para estandarizar eventos."
          crear_issue "Semana 4: Generaci√≥n de embeddings y b√∫squeda sem√°ntica" "Desarrollar embedding.py para vectorizaci√≥n y b√∫squeda eficiente."
          crear_issue "Semana 5: Construcci√≥n y uso del grafo de conocimiento" "Implementar grafo para relaciones y recomendaciones avanzadas."
          crear_issue "Semana 6: Interfaz de usuario con Streamlit" "Desarrollar visual.py para UI interactiva con filtros y agendas."
          crear_issue "Semana 7: Optimizaci√≥n y mejoras finales" "Refinar motor de recomendaciones, gesti√≥n de sesiones y documentaci√≥n."
          crear_issue "Semana 8: Preparaci√≥n para entrega y presentaci√≥n" "Redacci√≥n del README, reporte y preparaci√≥n de la presentaci√≥n final."
